<div class="analytics-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h2><i class="bi bi-bar-chart-line"></i> Analytics Dashboard</h2>
      <p>Overview of your platform statistics</p>
    </div>
    <div class="header-right">
      <input type="date" [(ngModel)]="startDate" (change)="onDateChange()" class="date-input" placeholder="Start Date">
      <input type="date" [(ngModel)]="endDate" (change)="onDateChange()" class="date-input" placeholder="End Date">
      <button *ngIf="startDate || endDate" (click)="clearDates()" class="btn-icon" title="Clear">
        <i class="bi bi-x-lg"></i>
      </button>
      <button (click)="refreshData()" [disabled]="loading" class="btn-icon" title="Refresh">
        <i class="bi bi-arrow-clockwise"></i>
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Content -->
  <div *ngIf="!loading" class="content">
    
    <!-- Stats Cards -->
    <div class="stats-row">
      
      <!-- Users -->
      <div class="stat-card blue">
        <div class="stat-icon">
          <i class="bi bi-people-fill"></i>
        </div>
        <div class="stat-info">
          <h3>{{ analytics.totalUsers }}</h3>
          <p>Total Users</p>
          <span class="stat-badge">+{{ analytics.newUsers }} new</span>
        </div>
      </div>

      <!-- Webinars -->
      <div class="stat-card green">
        <div class="stat-icon">
          <i class="bi bi-camera-video-fill"></i>
        </div>
        <div class="stat-info">
          <h3>{{ analytics.totalWebinars }}</h3>
          <p>Total Webinars</p>
          <span class="stat-badge">+{{ analytics.newWebinars }} new</span>
        </div>
      </div>

      <!-- Events -->
      <div class="stat-card orange">
        <div class="stat-icon">
          <i class="bi bi-calendar-event-fill"></i>
        </div>
        <div class="stat-info">
          <h3>{{ analytics.totalEvents }}</h3>
          <p>Total Events</p>
          <span class="stat-badge">+{{ analytics.newEvents }} new</span>
        </div>
      </div>

      <!-- Registrations -->
      <div class="stat-card purple">
        <div class="stat-icon">
          <i class="bi bi-person-check-fill"></i>
        </div>
        <div class="stat-info">
          <h3>{{ analytics.totalRegistrations }}</h3>
          <p>Total Registrations</p>
          <span class="stat-badge">+{{ analytics.newRegistrations }} new</span>
        </div>
      </div>

    </div>

    <!-- Chart Section -->
    <div class="chart-section">
      <div class="section-header">
        <h3><i class="bi bi-bar-chart-fill"></i> Registrations per Webinar</h3>
      </div>
      
      <div *ngIf="analytics.registrationsPerWebinar.length === 0" class="empty-state">
        <i class="bi bi-inbox"></i>
        <p>No data available</p>
      </div>

      <div *ngIf="analytics.registrationsPerWebinar.length > 0" class="chart-container">
        <div *ngFor="let item of analytics.registrationsPerWebinar" class="chart-bar">
          <div class="bar-label">{{ item.webinarTitle }}</div>
          <div class="bar-wrapper">
            <div class="bar-fill" [style.width.%]="getBarWidth(item.registrationCount)">
              <span class="bar-count">{{ item.registrationCount }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Table Section -->
    <div class="table-section">
      <div class="section-header">
        <h3><i class="bi bi-table"></i> Detailed View</h3>
        <input 
          type="text" 
          [(ngModel)]="searchQuery" 
          (input)="filterWebinars()" 
          placeholder="Search webinars..."
          class="search-input">
      </div>

      <div *ngIf="filteredWebinars.length === 0" class="empty-state">
        <i class="bi bi-search"></i>
        <p>No results found</p>
      </div>

      <table *ngIf="filteredWebinars.length > 0" class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Webinar Title</th>
            <th class="text-center">Registrations</th>
            <th class="text-center">Progress</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filteredWebinars; let i = index">
            <td>{{ i + 1 }}</td>
            <td><i class="bi bi-camera-video text-muted"></i> {{ item.webinarTitle }}</td>
            <td class="text-center">
              <span class="count-badge">{{ item.registrationCount }}</span>
            </td>
            <td class="text-center">
              <div class="progress-mini">
                <div class="progress-fill-mini" [style.width.%]="getBarWidth(item.registrationCount)"></div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>